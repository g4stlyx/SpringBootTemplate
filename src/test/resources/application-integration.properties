# ============================================================
# Test profile: integration
# Overrides application.properties for full context tests
# ============================================================

# --- H2 in-memory database (replaces MySQL) ---
spring.datasource.url=jdbc:h2:mem:integrationtestdb;DB_CLOSE_DELAY=-1;MODE=MySQL;NON_KEYWORDS=VALUE
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.driver-class-name=org.h2.Driver
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=false

# --- JWT (HMAC HS512 - must be 64+ bytes) ---
app.jwt.secret=integration-test-secret-key-for-hmac-sha512-minimum-sixty-four-bytes-required!!
app.jwt.expiration=900000
app.jwt.refresh-expiration=2592000000
app.jwt.issuer=g4stly

# --- Disable reCAPTCHA ---
recaptcha.enabled=false
recaptcha.site-key=dummy-site-key
recaptcha.secret-key=dummy-secret-key
recaptcha.score-threshold=0.5

# --- Cloudflare R2 (dummy values; S3Client won't make outbound calls unless used) ---
cloudflare.r2.access-key=dummy-access-key
cloudflare.r2.secret-key=dummy-secret-key
cloudflare.r2.account-id=dummy-account-id
cloudflare.r2.bucket-name=dummy-bucket
cloudflare.r2.public-domain=http://localhost

# --- Email (EmailService is @MockitoBean; these satisfy MailConfig @Value bindings) ---
spring.mail.host=localhost
spring.mail.port=25
spring.mail.username=test@test.com
spring.mail.password=dummy-password
spring.mail.properties.mail.smtp.auth=false
spring.mail.properties.mail.smtp.starttls.enable=false

# --- Security ---
app.security.pepper=test-pepper-value
app.data.init-users=false
app.frontend.url=http://localhost:3000
app.admin.email=admin@test.com

# --- Argon2id (lowered for fast test execution) ---
app.security.argon2.memory-cost=4096
app.security.argon2.time-cost=1
app.security.argon2.parallelism=1
app.security.argon2.salt-length=32
app.security.argon2.hash-length=64

# --- Database backup (disable) ---
app.database.backup.enabled=false
app.database.backup.recipient-email=test@test.com
app.database.backup.directory=target/test-backups
app.database.backup.mysqldump-path=mysqldump

# --- Rate limiting (high thresholds to avoid interfering with account-lock tests) ---
app.rate-limit.global.requests=10000
app.rate-limit.global.window=60000
app.rate-limit.login.attempts=10000
app.rate-limit.login.window=900000
app.rate-limit.api.calls=10000
app.rate-limit.api.window=60000
app.rate-limit.email-verification.attempts=10000
app.rate-limit.email-verification.window=3600000

# --- Logging (reduce noise in test output) ---
logging.level.com.g4stly=WARN
logging.level.org.springframework.security=WARN
logging.level.org.hibernate=WARN
